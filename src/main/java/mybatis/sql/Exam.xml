<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.daou.pd.user.exam.ExamMapper">
	<resultMap type="com.daou.pd.user.exam.ExamVO" id="examVO">
		<result column="problem_seq" property="problem_seq" />
		<result column="exam_test_no" property="exam_test_no" />
		<result column="reg_date" property="reg_date" />
		<result column="e_answer" property="e_answer" />
		<result column="r_answer" property="r_answer" />
		<result column="correct" property="correct" />
	</resultMap>

	<select id="test" resultType="Integer">
		select a from test where a=1
	</select>

	<select id="getCount" parameterType="Integer"
		resultType="Integer">
		select count(*) from problem_info where type = #{type}
	</select>

	<select id="getOption"
		resultType="com.daou.pd.admin.problem.OptionVO"
		parameterType="Integer">
		select * from option_info where problem_seq =
		#{problem_seq}
	</select>

	<select id="getOxList"
		resultType="com.daou.pd.admin.problem.ProblemVO" parameterType="Integer">
		select * from problem_info where type=1 order by rand() limit #{cnt}
	</select>

	<select id="getObjList"
		resultType="com.daou.pd.admin.problem.ProblemVO" parameterType="Integer">
		select * from problem_info where type=2 order by rand() limit #{cnt}
	</select>

	<select id="getPersence" parameterType="hashmap"
		resultType="Integer">
		select count(*) from exam_info where reg_id = #{reg_id} and
		exam_test_no = #{exam_test_no}
	</select>

	<insert id="insertExam" parameterType="java.util.Map">
		insert into exam_info (exam_test_no, problem_seq, reg_id, option1, option2, option3, option4, reg_date) values
		<foreach collection="examList" item="exam" separator=",">
			(#{exam.exam_test_no}, #{exam.problem_seq}, #{exam.reg_id}, #{exam.option1, jdbcType=INTEGER}, #{exam.option2, jdbcType=INTEGER} ,#{exam.option3, jdbcType=INTEGER}, #{exam.option4, jdbcType=INTEGER}, sysdate())
		</foreach>
	</insert>
	
	<select id="getexamList" parameterType="hashmap" resultType="com.daou.pd.admin.problem.ProblemVO">
		select distinct p.* from exam_info e, problem_info p where p.problem_seq = e.problem_seq and e.reg_id = #{reg_id} and e.exam_test_no = #{exam_test_no}
	</select>
	
	<select id="getoptionList" parameterType="hashmap" resultType="com.daou.pd.admin.problem.OptionVO">
		select o.* from option_info o, exam_info e where o.option_seq in (
		(select option1 from exam_info where reg_id = #{reg_id} and exam_test_no = #{exam_test_no} and problem_seq = #{problem_seq}),
		(select option2 from exam_info where reg_id = #{reg_id} and exam_test_no = #{exam_test_no} and problem_seq = #{problem_seq}),
		(select option3 from exam_info where reg_id = #{reg_id} and exam_test_no = #{exam_test_no} and problem_seq = #{problem_seq}),
		(select option4 from exam_info where reg_id = #{reg_id} and exam_test_no = #{exam_test_no} and problem_seq = #{problem_seq})
		) and e.problem_seq = #{problem_seq} and e.reg_id = #{reg_id} and e.exam_test_no = #{exam_test_no}
	</select>
	<select id="getExamList" resultType="com.daou.pd.user.exam.ExamListVO">
		select exam_test_no, date_format(s_date, '%Y-%m-%d') s_date, date_format(e_date, '%Y-%m-%d') e_date from exam_list order by exam_test_no desc
	</select>
	<select id="getQnum" parameterType="Integer" resultType="com.daou.pd.user.exam.ExamListVO">
		select * from exam_list where exam_test_no = #{exam_test_no}
	</select>
	<select id="getExamStatus" resultType="String" parameterType="hashmap">
		select distinct correct from exam_info where reg_id = #{reg_id} and exam_test_no = #{exam_test_no}
	</select>
</mapper>	 